<!DOCTYPE html>
<html>
<head>
    <title>Mauling Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
</head>
<body>
    <canvas id="game" width="800" height="600" style="border:1px solid #000"></canvas>
    <script>
        const connection = new signalR.HubConnectionBuilder().withUrl("/gameHub").build();
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        let players = [];
        let myId;

        connection.start().then(() => {
            const name = prompt("Enter name:");
            const isDog = confirm("Play as dog?");
            myId = connection.connectionId;
            connection.invoke("Join", name, isDog);
        });

        canvas.onmousemove = (e) => {
            const rect = canvas.getBoundingClientRect();
            connection.invoke("Move", e.clientX - rect.left, e.clientY - rect.top);
        };

        connection.on("update", newPlayers => {
            players = newPlayers;
            draw();
        });

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            players.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = p.isDog ? "brown" : "blue";
                ctx.fill();
                ctx.fillText(p.name, p.x - 10, p.y - p.size - 5);
            });
            requestAnimationFrame(draw);
        }
    </script>
</body>
</html>
